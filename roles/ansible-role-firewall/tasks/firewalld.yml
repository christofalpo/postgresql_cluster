---

- name: Deploying firewalld firewall settings
  ansible.builtin.debug:
    var: firewall_settings
  vars:
    firewall_settings:
      firewall_open_ports:
        ports: "{{ firewall_allowed_tcp_ports }}"

- name: Ensure firewalld is started at boot
  ansible.builtin.service:
    name: firewalld
    state: "{{ firewall_state }}"
    enabled: "{{ firewall_enabled_at_boot }}"

- name: Get active zone(s)
  ansible.builtin.command: "firewall-cmd --get-active-zones"
  register: firewalld_active_zones
  
- name: Add ports to zone
  ansible.posix.firewalld:
    permanent: true
    immediate: true
    state: "enabled"
    port: "{{ item }}/tcp"
  loop: "{{ firewall_allowed_tcp_ports | list }}"
  when: "firewall_allowed_tcp_ports is defined"

...